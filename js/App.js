import{TodoListDom}from"./ToDoList/TodoListDom.js";import{Timer}from"./Timer/Timer.js";import{Statistics}from"./Statistics/Statistics.js";import{Distraction}from"./Distraction/Distraction.js";import{shortBreakColors,workModeColors}from"./Misc/ChangeColors.js";import{breakModeSound,workModeSound}from"./Misc/Sounds.js";import{classNames}from"./ToDoList/TaskVariables.js";function after3amToday(){return(new Date).getHours()>=3}const timeDisplay=document.getElementById("timeDisplay"),modeDisplay=document.getElementById("modeDisplay"),todoTable=document.getElementById("todo"),addTodoForm=document.getElementById("add-todo"),addTodoButton=document.getElementById("add-button"),startTimerButton=document.getElementById("startTimer"),statsButton=document.getElementById("statsButton"),distractButton=document.getElementById("distractionButton"),distractPopUp=document.getElementById("distract-popup"),cancelButton=document.getElementById("cancel-button"),distractForm=document.getElementById("distract-form"),description=document.getElementById("description"),statsPopUp=document.getElementById("stats-section"),parentDiv=document.getElementById("parentDiv"),closeStatsButton=document.getElementById("close-stats-button"),deleteAllButton=document.getElementById("delete-all-button"),overlay=document.getElementById("overlay"),statsTabBtn=document.getElementById("data"),currentTaskDiv=document.getElementById("currentTask"),tourButton=document.getElementById("onboardingButton"),StatsPage=new Statistics,TDLDom=new TodoListDom(todoTable,addTodoForm,addTodoButton,deleteAllButton,currentTaskDiv),TimerObj=new Timer(startTimerButton,timeDisplay,modeDisplay),DistractionPage=new Distraction(distractButton,distractPopUp,cancelButton,distractForm,description,overlay);null===localStorage.getItem("onboarding")&&(introJs().start(),localStorage.setItem("onboarding","true")),tourButton.addEventListener("click",(()=>{introJs().start()})),TimerObj.addEventListener("timer-complete",(t=>{t.detail.sessionIsWork?(TDLDom.onSessionComplete(),StatsPage.addWorkTime(t.detail.duration),StatsPage.incrementActualPomoSessions(),shortBreakColors(),breakModeSound()):(StatsPage.addTimeSpent(t.detail.duration),workModeColors(),workModeSound())})),startTimerButton.addEventListener("click",(()=>{if(StatsPage.dataToCompressExists()&&StatsPage.clearData(),"Start"===startTimerButton.childNodes[0].nodeValue){StatsPage.compressStats();const t=new Date(2e3,0,1);localStorage.setItem("startDateTime",t),StatsPage.sessionStartDateTime=t}})),TimerObj.addEventListener("timer-start",(t=>{t.detail.sessionIsWork?distractButton.disabled=!1:distractButton.disabled=!0})),TimerObj.addEventListener("timer-end",(()=>{distractButton.disabled=!0})),document.body.addEventListener("focus-task",(t=>{TDLDom.onFocusTask(t.detail.taskID),TDLDom.updateCurrentTask()})),document.body.addEventListener("task-deleted",(t=>{TDLDom.todoList.removeTask(t.detail.taskID),TDLDom.updateCurrentTask()})),document.body.addEventListener("checkbox-updated",(t=>{!0===t.detail.checkBoxState?TDLDom.onCompletedTask():TDLDom.onUncheckedTask(t.detail.taskID),TDLDom.updateCurrentTask()})),window.addEventListener("click",(t=>{const e=document.getElementsByClassName(classNames.lastCol);let o=!1;for(let s=0;s<e.length&&!o;s+=1)e[s].contains(t.target)&&(o=!0);if(!o){const t=document.getElementsByClassName(classNames.doubleButtons),e=document.getElementsByClassName(classNames.threeDotsWrapper);for(let o=0;o<t.length;o+=1)t[o].style.display="none",e[o].style.display="block"}})),TDLDom.todoList.addEventListener("task-added",(t=>{StatsPage.addExpectedPomoSessions(t.detail.duration)})),TDLDom.todoList.addEventListener("task-checked-off",(()=>{StatsPage.incrementTasksCompleted()})),TDLDom.todoList.addEventListener("task-unchecked",(()=>{StatsPage.decrementTasksCompleted()})),TDLDom.todoList.addEventListener("task-deleted",(t=>{StatsPage.deleteExpectedPomoSessions(t.detail.pomoSessions)})),DistractionPage.addEventListener("distraction-created",(t=>{t.detail.pomoSessionId=TimerObj.sessionId,StatsPage.addDistraction(t.detail)})),StatsPage.addEventListener("reset-timer",(()=>{TimerObj.resetPomoSessionId()})),statsButton.addEventListener("click",(()=>{StatsPage.updateDom(),statsPopUp.style.display="block",parentDiv.style.display="block",statsPopUp.style.animation="fadeEffect-popup 1s",overlay.style.animation="fadeEffect-overlay 1s",parentDiv.setAttribute("class","slide-in"),document.getElementById("overlay").style.display="block"})),closeStatsButton.addEventListener("click",(()=>{parentDiv.setAttribute("class","slide-out"),statsPopUp.style.display="none",document.getElementById("overlay").style.display="none"})),after3amToday()&&StatsPage.dataToCompressExists()&&(StatsPage.compressStats(),StatsPage.clearData()),statsTabBtn.click();
