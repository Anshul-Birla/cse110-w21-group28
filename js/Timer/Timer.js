import{sessionStartName,workMode,shortBreakMode,longBreakMode,buttonText}from"./TimerVariables.js";class Timer extends HTMLElement{constructor(t,e,s){super(),this.state="",this.stateQueue=[],this.startButton=t,this.displayTime=e,this.displayStatus=s,this.end=!1,this.sessionId=localStorage.getItem("pomoSessionId"),this.sessionId=null===this.sessionId?0:parseInt(this.sessionId,10)+1;const o=[workMode,shortBreakMode,workMode,shortBreakMode,workMode,shortBreakMode,workMode,longBreakMode];for(let t=0;t<o.length;t+=1)this.stateQueue.push(o[t]);this.addEventListeners()}resetPomoSessionId(){this.sessionId=0,localStorage.setItem("pomoSessionId",this.sessionId)}onTimerComplete(){const t=this.stateQueue.shift();this.stateQueue.push(t);const e=new CustomEvent("timer-complete",{detail:{sessionName:t.name,duration:t.duration,sessionIsWork:t.isWork,sessionId:this.sessionId}});this.dispatchEvent(e),t.isWork||(this.sessionId+=1,localStorage.setItem("pomoSessionId",this.sessionId)),this.startTimer()}startTimer(){this.end=!1;const t=this.stateQueue[0];this.state=t.name,this.displayStatus.textContent=this.state;const e=new CustomEvent("timer-start",{detail:{sessionName:this.state,sessionIsWork:t.isWork}});this.dispatchEvent(e),this.countdown(60*t.duration)}endTimer(){this.end=!0,this.displayStatus.textContent=sessionStartName,this.displayTime.textContent="25:00",document.title="Pomodoro",this.stateQueue=[];const t=[workMode,shortBreakMode,workMode,shortBreakMode,workMode,shortBreakMode,workMode,longBreakMode];for(let e=0;e<t.length;e+=1)this.stateQueue.push(t[e]);const e=new CustomEvent("timer-end");this.dispatchEvent(e)}countdown(t){if(this.end)return;const e=Math.floor(t/60),s=t%60;let o="";o=s<10?`${e}:0${s}`:`${e}:${s}`,this.displayTime.textContent=o,document.title=`${this.state} ${o}`,(t-=1)>=0?setTimeout((()=>{this.countdown(t)}),1e3):this.onTimerComplete()}addEventListeners(){this.startButton.addEventListener("click",(()=>{this.startButton.textContent.indexOf(buttonText.startTimerText)>-1?(this.startTimer(),this.startButton.childNodes[0].nodeValue=buttonText.stopTimerText):(this.endTimer(),this.startButton.childNodes[0].nodeValue=buttonText.startTimerText,document.getElementsByTagName("body")[0].classList.remove("short-break"))}))}}customElements.define("custom-timer",Timer);export{Timer};
