import{classNames,storageItemNames}from"./StatisticsVariables.js";class Statistics extends HTMLElement{constructor(){super(),this.distractionList=[],this.totalMins=0,this.workMins=0,this.tasksCompleted=0,this.expectedPomoSessions=0,this.actualPomoSessions=0,this.sessionStartDateTime=new Date,this.addHTMLChildren(),this.addEventListeners(),this.loadFromLocalStorage(),this.flushHistory()}addHTMLChildren(){this.parentDiv=document.getElementById("stats-info"),this.tasksCompletedP=document.createElement("p"),this.tasksCompletedP.setAttribute("id","stats_tasksCompleted"),this.tasksCompletedP.setAttribute("class",classNames.statsNumberClass),this.tasksCompletedPLabel=document.createElement("p"),this.tasksCompletedPLabel.setAttribute("id","stats_tasksCompletedLabel"),this.tasksCompletedPLabel.setAttribute("class",classNames.statsLabelClass),this.tasksCompletedPLabel.textContent="Tasks Completed",this.parentDiv.appendChild(this.tasksCompletedP),this.parentDiv.appendChild(this.tasksCompletedPLabel),this.timeSpent=document.createElement("p"),this.timeSpent.setAttribute("id","stats_totalTime"),this.timeSpent.setAttribute("class",classNames.statsNumberClass),this.timeSpentLabel=document.createElement("p"),this.timeSpentLabel.setAttribute("id","stats_timeSpentLabel"),this.timeSpentLabel.setAttribute("class",classNames.statsLabelClass),this.timeSpentLabel.textContent="Total Minutes",this.parentDiv.appendChild(this.timeSpent),this.parentDiv.appendChild(this.timeSpentLabel),this.timeWorking=document.createElement("p"),this.timeWorking.setAttribute("id","stats_workTime"),this.timeWorking.setAttribute("class",classNames.statsNumberClass),this.timeWorkingLabel=document.createElement("p"),this.timeWorkingLabel.setAttribute("id","stats_timeWorkingLabel"),this.timeWorkingLabel.setAttribute("class",classNames.statsLabelClass),this.timeWorkingLabel.textContent="Working Minutes",this.parentDiv.appendChild(this.timeWorking),this.parentDiv.appendChild(this.timeWorkingLabel),this.timePerTask=document.createElement("p"),this.timePerTask.setAttribute("id","stats_timePerTask"),this.timePerTask.setAttribute("class",classNames.statsNumberClass),this.timePerTaskLabel=document.createElement("p"),this.timePerTaskLabel.setAttribute("id","stats_timePerTaskLabel"),this.timePerTaskLabel.setAttribute("class",classNames.statsLabelClass),this.timePerTaskLabel.textContent="Minutes per Task",this.parentDiv.appendChild(this.timePerTask),this.parentDiv.appendChild(this.timePerTaskLabel),this.brokenSessions=document.createElement("p"),this.brokenSessions.setAttribute("id","stats_numBrokenSessions"),this.brokenSessions.setAttribute("class",classNames.distNumberClass),this.brokenSessionsLabel=document.createElement("p"),this.brokenSessionsLabel.setAttribute("id","stats_brokenSessionsLabel"),this.brokenSessionsLabel.setAttribute("class",classNames.distLabelClass),this.brokenSessionsLabel.textContent="Broken Sessions",this.parentDiv.appendChild(this.brokenSessions),this.parentDiv.appendChild(this.brokenSessionsLabel),this.expectedPomoSessionsData=document.createElement("p"),this.expectedPomoSessionsData.setAttribute("id","stats_expectedPomoSesh"),this.expectedPomoSessionsData.setAttribute("class",classNames.statsNumberClass),this.expectedPomoSessionsLabel=document.createElement("p"),this.expectedPomoSessionsLabel.setAttribute("id","stats_expectedPomoSesLabel"),this.expectedPomoSessionsLabel.setAttribute("class",classNames.statsLabelClass),this.expectedPomoSessionsLabel.textContent="Expected Pomo Sessions",this.parentDiv.appendChild(this.expectedPomoSessionsData),this.parentDiv.appendChild(this.expectedPomoSessionsLabel),this.actualPomoSessionsData=document.createElement("p"),this.actualPomoSessionsData.setAttribute("id","stats_actualPomo"),this.actualPomoSessionsData.setAttribute("class",classNames.statsNumberClass),this.actualPomoSessionsLabel=document.createElement("p"),this.actualPomoSessionsLabel.setAttribute("id","stats_actualPomoSesLabel"),this.actualPomoSessionsLabel.setAttribute("class",classNames.statsLabelClass),this.actualPomoSessionsLabel.textContent="Actual Pomo Sessions",this.parentDiv.appendChild(this.actualPomoSessionsData),this.parentDiv.appendChild(this.actualPomoSessionsLabel),this.avgDistractions=document.createElement("p"),this.avgDistractions.setAttribute("id","dist_avgDistractions"),this.avgDistractions.setAttribute("class",classNames.distNumberClass),this.avgDistractionsLabel=document.createElement("p"),this.avgDistractionsLabel.setAttribute("id","dist_avgDistractionLabel"),this.avgDistractionsLabel.setAttribute("class",classNames.distLabelClass),this.avgDistractionsLabel.textContent="Average Distractions Per Task",this.parentDiv.appendChild(this.avgDistractions),this.parentDiv.appendChild(this.avgDistractionsLabel),this.distList=document.createElement("ul"),this.distList.setAttribute("class","dist-list"),this.parentDiv.appendChild(this.distList),this.distListLabel=document.createElement("p"),this.distListLabel.setAttribute("id","dist_listLabel"),this.distListLabel.setAttribute("class",classNames.distLabelClass),this.distListLabel.textContent="Distraction List",this.parentDiv.appendChild(this.distListLabel)}updateDistractionList(){const t=document.getElementsByClassName("distItem");let s;for(s=0===t.length?0:t.length;s<this.distractionList.length;)this.listElement=document.createElement("li"),this.listElement.setAttribute("class","distItem"),this.listElement.textContent=this.distractionList[s].description,this.distList.appendChild(this.listElement),s+=1}addEventListeners(){const t=document.getElementById("distraction"),s=document.getElementById("data");t.addEventListener("click",(()=>{s.className=classNames.nonActiveTabClass;let e=document.getElementsByClassName(classNames.statsNumberClass),i=document.getElementsByClassName(classNames.statsLabelClass);for(let t=0;t<e.length;t+=1)e[t].style.display="none",i[t].style.display="none";e=document.getElementsByClassName(classNames.distNumberClass),i=document.getElementsByClassName(classNames.distLabelClass),document.getElementsByClassName("dist-list")[0].style.display="block";for(let t=0;t<e.length;t+=1)e[t].style.display="block";for(let t=0;t<i.length;t+=1)i[t].style.display="block";t.className=classNames.activeTabClass})),s.addEventListener("click",(()=>{t.className=classNames.nonActiveTabClass;let e=document.getElementsByClassName(classNames.distNumberClass),i=document.getElementsByClassName(classNames.distLabelClass);for(let t=0;t<e.length;t+=1)e[t].style.display="none";for(let t=0;t<i.length;t+=1)i[t].style.display="none";document.getElementsByClassName("dist-list")[0].style.display="none",e=document.getElementsByClassName(classNames.statsNumberClass),i=document.getElementsByClassName(classNames.statsLabelClass);for(let t=0;t<e.length;t+=1)e[t].style.display="block",i[t].style.display="block";s.className=classNames.activeTabClass})),document.getElementById("overlay").addEventListener("click",(()=>{document.getElementById("close-stats-button").click(),document.getElementById("overlay").style.animation=""}))}updateDom(){this.timePerTask.textContent=this.getAverageTimePerTask(),this.tasksCompletedP.textContent=this.tasksCompleted,this.timeWorking.textContent=this.workMins,this.timeSpent.textContent=this.totalMins,this.brokenSessions.textContent=this.getNumUniqueDistractions(),this.avgDistractions.textContent=this.getAvgDistractionsPerTask(),this.expectedPomoSessionsData.textContent=this.expectedPomoSessions,this.actualPomoSessionsData.textContent=this.actualPomoSessions,this.updateDistractionList()}incrementTasksCompleted(){this.tasksCompleted+=1,this.updateMinorLocalStorage()}decrementTasksCompleted(){this.tasksCompleted>0&&(this.tasksCompleted-=1,this.updateMinorLocalStorage())}addDistraction(t){this.distractionList.push(t),this.updateMinorLocalStorage()}getNumUniqueDistractions(){return new Set(this.distractionList.map((t=>t.pomoSessionId))).size}getAvgDistractionsPerTask(){if(0===this.tasksCompleted)return 0;const t=this.distractionList.length/this.tasksCompleted;return Math.round(10*t)/10}addTimeSpent(t){this.totalMins+=1*t,this.updateMinorLocalStorage()}addWorkTime(t){this.workMins+=1*t,this.addTimeSpent(t)}addExpectedPomoSessions(t){this.expectedPomoSessions+=t,this.updateMinorLocalStorage()}deleteExpectedPomoSessions(t){this.expectedPomoSessions>=t&&(this.expectedPomoSessions-=t,this.updateMinorLocalStorage())}incrementActualPomoSessions(){this.actualPomoSessions+=1,this.updateMinorLocalStorage()}getAverageTimePerTask(){return this.tasksCompleted>0?Math.round(this.workMins/this.tasksCompleted):0}loadFromLocalStorage(){if(this.history=JSON.parse(localStorage.getItem("statsHistory")),null===this.history&&(this.history=[]),this.totalMins=localStorage.getItem(storageItemNames.totalMins),this.workMins=localStorage.getItem(storageItemNames.workMins),this.tasksCompleted=localStorage.getItem(storageItemNames.tasksCompleted),this.expectedPomoSessions=localStorage.getItem(storageItemNames.expectedPomoSessions),this.actualPomoSessions=localStorage.getItem(storageItemNames.actualPomoSessions),this.distractionList=localStorage.getItem(storageItemNames.currDistractionList),this.sessionStartDateTime=localStorage.getItem(storageItemNames.startDateTime),this.totalMins=null!==this.totalMins?parseInt(this.totalMins,10):0,this.workMins=null!==this.workMins?parseInt(this.workMins,10):0,this.tasksCompleted=null!==this.tasksCompleted?parseInt(this.tasksCompleted,10):0,this.expectedPomoSessions=null!==this.expectedPomoSessions?parseInt(this.expectedPomoSessions,10):0,this.actualPomoSessions=null!==this.actualPomoSessions?parseInt(this.actualPomoSessions,10):0,this.tasksCompleted=null!==this.tasksCompleted?parseInt(this.tasksCompleted,10):0,this.sessionStartDateTime=null!==this.sessionStartDateTime?new Date(this.sessionStartDateTime):new Date,null!==this.distractionList){this.distractionList=JSON.parse(this.distractionList);for(let t=0;t<this.distractionList.length;t+=1)this.distractionList[t].date=new Date(this.distractionList[t].date)}else this.distractionList=[]}updateMinorLocalStorage(){localStorage.setItem(storageItemNames.totalMins,this.totalMins),localStorage.setItem(storageItemNames.workMins,this.workMins),localStorage.setItem(storageItemNames.tasksCompleted,this.tasksCompleted),localStorage.setItem(storageItemNames.expectedPomoSessions,this.expectedPomoSessions),localStorage.setItem(storageItemNames.actualPomoSessions,this.actualPomoSessions),localStorage.setItem(storageItemNames.currDistractionList,JSON.stringify(this.distractionList)),localStorage.setItem(storageItemNames.startDateTime,this.sessionStartDateTime)}flushHistory(){const t=new Date;for(let s=0;s<this.history.length;s+=1){(t-new Date(this.history[s].date))/31536e6>1&&this.history.splice(s,1)}localStorage.setItem("statsHistory",JSON.stringify(this.history))}dataToCompressExists(){const t=new Date;return this.sessionStartDateTime.getFullYear()<t.getFullYear()||(this.sessionStartDateTime.getMonth()<t.getMonth()||(this.sessionStartDateTime.getDate()<t.getDate()||this.sessionStartDateTime.getHours()<=2))}compressStats(){this.totalMins>0&&(this.history.push({date:this.sessionStartDateTime,distractionCount:this.distractionList.length,timeSpent:this.totalMins}),localStorage.setItem("statsHistory",JSON.stringify(this.history)));const t=new CustomEvent("reset-timer",{});this.dispatchEvent(t)}clearData(){this.totalMins=0,this.workMins=0,this.tasksCompleted=0,this.expectedPomoSessions=0,this.actualPomoSessions=0,this.distractionList=[],this.sessionStartDateTime=new Date,this.updateMinorLocalStorage()}}customElements.define("stats-block",Statistics);export{Statistics};
