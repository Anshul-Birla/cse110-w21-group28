import{classNames,svg}from"./TaskVariables.js";import{TaskStorage}from"./TodoListDomVariables.js";class Task extends HTMLTableRowElement{constructor(e,t,s,a=0,n=!1){super(),this.className=classNames.uncheckedTaskClassName,this.id=e,this.name=t,this.totalSessions=s,this.currentSessionNum=a,this.checked=n,this.checkBox=this.setupCheckBox(),this.taskText=this.setupTaskText(),this.pomoSessions=this.setupTotalPomoSessions(),this.deleteButton=this.setupDeleteButton(),this.threeDotsButton=this.setupThreeDotsButton(),this.focusButton=this.setupFocusButton(),this.setupLastColumnToggle(this.threeDotsButton,this.deleteButton.parentElement,this.focusButton.parentElement)}setupCheckBox(){const e=document.createElement("td"),t=document.createElement("input");return t.setAttribute("type","checkbox"),t.setAttribute("id",`checkbox-${this.id}`),t.setAttribute("class","custom_checkbox"),e.appendChild(t),this.appendChild(e),t.disabled=!0,this.checked&&(this.setAttribute("class",classNames.completedTaskClassName),t.checked=!0,t.disabled=!1),t.addEventListener("click",(()=>{this.checked?this.uncheckTask():this.checkOffTask();const e=new CustomEvent("checkbox-updated",{bubbles:!0,composed:!0,detail:{taskID:this.id,checkBoxState:this.checked}});document.body.dispatchEvent(e)})),t}setupTaskText(){const e=document.createElement("td");return e.setAttribute("id",`text-${this.id}`),this.appendChild(e),this.updateText(),e}setupTotalPomoSessions(){const e=document.createElement("td");return e.setAttribute("id",`pomoSessions-${this.id}`),this.appendChild(e),this.updatePomoSessions(),e}setupDeleteButton(){const e=document.createElement("button"),t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttributeNS(null,"d",svg.trashcan);const s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.appendChild(t),s.setAttribute("class",classNames.deleteSvg),e.appendChild(s);const a=document.createElement("div");return a.className=classNames.inlineDiv,a.appendChild(e),e.addEventListener("click",(()=>{this.onDelete()})),e}setupFocusButton(){const e=document.createElement("button"),t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttributeNS(null,"d",svg.star);const s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttribute("class",classNames.focusSvg),s.appendChild(t),e.appendChild(s);const a=document.createElement("div");return a.className=classNames.inlineDiv,a.appendChild(e),this.checked&&(e.parentElement.style.display="none"),e.addEventListener("click",(()=>{this.threeDotsButton.parentElement.style.display="block",e.parentElement.parentElement.style.display="none";const t=new CustomEvent("focus-task",{bubbles:!0,composed:!0,detail:{taskID:this.id}});document.body.dispatchEvent(t)})),e}setupThreeDotsButton(){const e=document.createElement("button"),t=document.createElement("div");return t.className=classNames.threeDots,e.appendChild(t),e.addEventListener("click",(()=>{e.parentElement.style.display="none",this.deleteButton.parentElement.parentElement.style.display="inline-block"})),e}setupLastColumnToggle(e,t,s){const a=document.createElement("td"),n=document.createElement("div"),o=document.createElement("div"),i=document.createElement("div");i.className=classNames.doubleButtons,i.appendChild(t),i.appendChild(s),o.appendChild(e),o.className=classNames.threeDotsWrapper,i.style.display="none",n.appendChild(o),n.className=classNames.lastCol,n.appendChild(i),a.appendChild(n),this.appendChild(a)}removeFromLocalStorage(){for(let e=0;e<window.localData.length;e+=1)window.localData[e][TaskStorage.idIndex]===this.id&&window.localData.splice(e,1);localStorage.setItem("tasks",JSON.stringify(window.localData))}updateText(){this.children[1].textContent=this.name}updatePomoSessions(){this.children[2].textContent=`${this.currentSessionNum}/      ${this.totalSessions}`}incrementSession(){if(this.checked)throw new RangeError("Increment checked Task");this.currentSessionNum+=1,this.updatePomoSessions(),this.updateLocalStorage()}updateLocalStorage(){for(let e=0;e<window.localData.length;e+=1)window.localData[e][TaskStorage.idIndex]===this.id&&(window.localData[e][TaskStorage.currentSessionIndex]=this.currentSessionNum,window.localData[e][TaskStorage.checkedIndex]=this.checked);localStorage.setItem("tasks",JSON.stringify(window.localData))}checkOffTask(){this.checked=!0,this.setAttribute("class",classNames.completedTaskClassName);const e=new CustomEvent("task-checked-off",{});this.dispatchEvent(e),this.focusButton.parentElement.style.display="none",this.updateLocalStorage()}uncheckTask(){this.checked=!1,this.setAttribute("class",classNames.uncheckedTaskClassName),this.focusButton.parentElement.style.display="inline-block",this.checkBox.disabled=!0,this.updateLocalStorage()}onDelete(){this.remove(),this.removeFromLocalStorage();let e=new CustomEvent("task-deleted",{bubbles:!0,composed:!0,detail:{taskID:this.id}});document.body.dispatchEvent(e),e=new CustomEvent("task-deleted",{detail:{pomoSessions:this.totalSessions}}),this.dispatchEvent(e)}}export{Task};customElements.define("task-item",Task,{extends:"tr"});
